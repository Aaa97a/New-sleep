<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="robots" content="noindex,nofollow">

        <title>勉強に集中したい！勉強への集中力をアップする方法とは？</title>
        <link rel="icon" href="/img/logo/favicon.ico">
        
        <link rel="stylesheet" href="/css/pure-min.css">
        <link rel="stylesheet" href="/css/grids-responsive-min.css">
        <link rel="stylesheet" href="/css/ionicons.min.css">
        <link rel="stylesheet" href="/css/default.css">
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=thumb_up" />
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="/js/utils/utils.js"></script>
	      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <style>
    /* グローバル変数と基本スタイル */
    :root {
      --yt-spec-base-background: #ffffff;
      --yt-spec-raised-background: #ffffff;
      --yt-spec-menu-background: #ffffff;
      --yt-spec-inverted-background: #0f0f0f;
      --yt-spec-outline: rgba(0, 0, 0, 0.1);
      --yt-spec-text-primary: #0f0f0f;
      --yt-spec-text-secondary: #606060;
      --yt-spec-red: #ff0000;
      --yt-spec-brand-button-text: #065fd4;
    }

    body {
      font-family: Roboto, Arial, sans-serif;
      background-color: var(--yt-spec-base-background);
      color: var(--yt-spec-text-primary);
      margin: 0;
      padding: 0;
      line-height: 1.4;
    }

    /* ヘッダー（YouTube風） */
    .youtube-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background-color: var(--yt-spec-base-background);
      border-bottom: 1px solid var(--yt-spec-outline);
      display: flex;
      align-items: center;
      padding: 0 16px;
      z-index: 2020;
      box-sizing: border-box;
    }
    .youtube-logo {
      display: flex;
      align-items: center;
      margin-right: 40px;
      text-decoration: none;
      color: var(--yt-spec-text-primary);
    }
    .youtube-logo i {
      color: var(--yt-spec-red);
      font-size: 20px;
      margin-right: 6px;
    }
    .youtube-logo span {
      font-size: 16px;
      font-weight: 500;
      letter-spacing: -0.5px;
    }

    /* YouTubeライク検索バー */
    .youtube-search {
      display: flex;
      flex: 1;
      max-width: 640px;
      margin: 0 auto;
    }
    .search-container {
      display: flex;
      flex: 1;
      height: 40px;
    }
    .search-input {
      flex: 1;
      border: 1px solid #ccc;
      border-right: none;
      border-radius: 40px 0 0 40px;
      padding: 0 16px;
      font-size: 16px;
      outline: none;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    .search-input:focus {
      border-color: var(--yt-spec-brand-button-text);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    .search-button {
      width: 64px;
      background-color: #f8f9fa;
      border: 1px solid #ccc;
      border-radius: 0 40px 40px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .search-button:hover {
      background-color: #f0f0f0;
    }

    /* メインコンテンツ */
    .main-content {
      margin-top: 56px;
      min-height: calc(100vh - 56px);
    }
    .video-player-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 24px 16px;
    }
    
    /* 動画プレーヤー */
    .video-player-wrapper {
      position: relative;
    }
    .video-player-wrapper video {
      width: 100%;
      height: auto;
      aspect-ratio: 16/9;
      background: #000;
    }

    /* 以下は動画情報やチャンネル情報、動画説明、コメントのスタイル */
    .video-info {
      margin-top: 16px;
    }
    .video-title {
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    .video-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      color: var(--yt-spec-text-secondary);
    }
    .channel-info {
      display: flex;
      align-items: center;
      background-color: #f9f9f9;
      padding: 12px;
      border-radius: 4px;
      margin-top: 16px;
      text-align: left;
    }
    .channel-avatar {
      margin-right: 12px;
    }
    .channel-avatar img {
      border-radius: 50%;
      width: 48px;
      height: 48px;
    }
    .channel-info h6 {
      margin: 0;
    }
    .video-description {
      margin-top: 24px;
      text-align: left;
    }
    .description-content {
      background-color: #f9f9f9;
      padding: 12px;
      border-radius: 4px;
    }
    .description-content button {
      background: none;
      border: none;
      color: var(--yt-spec-brand-button-text);
      cursor: pointer;
      padding: 0;
      margin-top: 8px;
      font-size: 14px;
    }
    .comments-section {
      margin-top: 32px;
      text-align: left;
    }
    .card {
      border: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      border-radius: 4px;
      background-color: var(--yt-spec-raised-background);
    }
    .card-header {
      background-color: #f1f1f1;
      padding: 8px 16px;
      border-bottom: 1px solid var(--yt-spec-outline);
    }
    .card-body {
      padding: 16px;
    }
    .comment-item {
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--yt-spec-outline);
    }
    .comment-item:last-child {
      border-bottom: none;
    }
    .comment-avatar {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 50%;
    }
    .comment-header {
      margin-bottom: 4px;
    }
    .comment-author {
      font-weight: bold;
      margin-right: 8px;
    }
    .comment-actions {
      font-size: 12px;
      color: var(--yt-spec-text-secondary);
    }

    /* レスポンシブ対応（グリッドレイアウト） */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
      padding: 24px 16px;
    }
    @media (max-width: 768px) {
      .video-grid {
        grid-template-columns: 1fr;
        padding: 16px 8px;
      }
    }

    /* Invidious風 no-theme セクション（※配置を２カラムに変更） */
    .no-theme {
      background-color: var(--yt-spec-base-background);
      color: var(--yt-spec-text-primary);
      padding: 16px;
    }
    .pure-g {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    .h-box {
      display: flex;
      align-items: center;
    }
    .pure-u-1 { width: 100%; }
    /* 画面が広いときは２カラムにする */
    .pure-u-lg-1-3 {
      flex: 0 0 33.33%;
    }
    .pure-u-lg-2-3 {
      flex: 0 0 66.66%;
    }
    /* 推奨動画と動画詳細エリアは左寄せ */
    .recommendations, .video-details {
      text-align: left;
    }
    /* 推奨動画内のサムネイル */
    .thumbnail {
      position: relative;
      width: 100%;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    .thumbnail img {
      width: 100%;
      display: block;
    }
    .length {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    /* フォーム内の検索ボックス */
    .searchbar form, #searchbox {
      width: 100%;
    }
    #searchbox {
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #player-container {
      margin-top: 16px;
    }
    .player-style-invidious {
      background-color: #000;
      border: none;
      width: 100%;
    }
    .channel-profile {
      display: flex;
      align-items: center;
    }
    .channel-profile img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 12px;
    }
  </style>
  <!-- Font Awesome（アイコン用） -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
  <!-- ヘッダー -->
  <header class="youtube-header">
    <a href="#" class="youtube-logo">
      <i class="fab fa-youtube"></i>
      <span>YouTube風サイト</span>
    </a>
    <div class="youtube-search">
      <div class="search-container">
        <input type="text" class="search-input" placeholder="検索">
        <button class="search-button"><i class="fas fa-search"></i></button>
      </div>
    </div>
    <div class="header-actions">
      <a href="#" class="shorts-link" style="display: flex; align-items: center; padding: 8px 12px; text-decoration: none; color: var(--yt-spec-text-primary); border-radius: 18px; transition: background-color 0.1s;">
        <i class="fas fa-bolt" style="margin-right: 6px; font-size: 16px;"></i>
        <span style="font-size: 14px; font-weight: 500;">Shorts</span>
      </a>
    </div>
  </header>

  <!-- メインコンテンツ（動画プレーヤーなど） -->
  <main class="main-content">
    <div class="video-player-container">
      <!-- 動画プレーヤー -->
      <div class="video-player-wrapper">
        <video id="videoPlayer" controls preload="none" playsinline style="width: 100%; height: auto; aspect-ratio: 16/9; background: #000;">
          <source src="https://rr3---sn-vgqsknz6.googlevideo.com/videoplayback?..." type="video/mp4">
          <p>このビデオを再生するには、HTML5対応ブラウザが必要です。</p>
        </video>
      </div>
      <!-- ※必要であれば動画情報などもここに配置可能 -->
    </div>

    <!-- Invidious風 no-theme セクション（２カラムレイアウト） -->
    <div class="no-theme">
      <span id="dark_mode_pref" style="display:none"></span>
      <div class="pure-g">
        <!-- 左側：おすすめ動画（関連動画） -->
        <div class="pure-u-1 pure-u-lg-1-3 recommendations">
          <!-- 自動再生・ループ切替（必要に応じて上部に設置） -->
          <label for="autonextpage">自動で次の動画に遷移<input id="autonextpage" type="checkbox" onchange="changeAutoNextPage(this)"></label><br>
          <label for="loop">ループ再生<input id="loop" type="checkbox" onchange="changeLoop(this)"></label>
          <!-- 推奨動画リスト -->
          {% for rec_video in recommended_videos %}
          <a href="/watch?v={{ rec_video['video_id'] }}">
            <div class="thumbnail">
              <img loading="lazy" src="{% if proxy == 'True' %}/thumbnail?v={{ rec_video['video_id'] }}{% else %}https://img.youtube.com/vi/{{ rec_video['video_id'] }}/0.jpg{% endif %}" alt="{{ rec_video['title'] }}">
              <p class="length">{{ rec_video["length_text"] }}</p>
            </div>
            <p style="width:100%;">{{ rec_video["title"] }}</p>
          </a>
          <p>{{ rec_video["view_count_text"] }}回視聴</p>        
          <a href="/channel/{{ rec_video['authorId'] }}">{{ rec_video["author"] }}</a>
          {% endfor %}
        </div>
        <!-- 右側：動画詳細（ダウンロードリンク、チャンネル情報、動画説明、コメント） -->
        <div class="pure-u-1 pure-u-lg-2-3 video-details">
          <!-- ダウンロード・視聴リンク -->
          <div class="download-links" style="text-align:left;">
            <a href="{{ videourls[0] }}" download="{{ video_title }}">ダウンロード</a><br>
            <a href="javascript:location.replace('/watch?v={{ videoid }}')">デフォルトで視聴する</a><br>
            <a href="javascript:location.replace('/ume?v={{ videoid }}')">埋め込み(nocookie)で視聴する</a><br>
            <a href="javascript:location.replace('/w?v={{ videoid }}')">高画質再生‼︎</a>
            <hr>
          </div>
          <div class="main-info">
            <div class="channel-info">
              <a href="/channel/{{ author_id }}" style="text-decoration:none;">
                <div class="channel-profile">
                  <img src="{{ author_icon }}" alt="{{ author }}">
                  <span id="channel-name">{{ author }}</span>
                </div>
              </a>
              <p>チャンネル登録者数: {{ subscribers_count }}人</p>
            </div>
            <div class="video-description">
              <div id="description-box">
                <div id="descriptionWrapper">{{ description | safe }}</div>
              </div>
              <hr>
            </div>
            <div class="comments-section">
              <h3>コメント</h3>
              <div id="comments">
                <!-- コメントアイテムをここに挿入 -->
              </div>
            </div>
          </div>
        </div><!-- .video-details -->
      </div><!-- .pure-g -->
    </div><!-- .no-theme -->
  </main>

        <div class="pure-u-1 pure-u-md-2-24"></div>
        
        <script>
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/comments?v=" + getQueryValue('v'));
            xhr.onload = function () {      
                if (xhr.status == 200) {
                    const comments_div = document.getElementById('comments');
                    comments_div.innerHTML = xhr.responseText;

                    const comments_a_tags = comments_div.getElementsByTagName('a');

                    for(let i = 0; i < comments_a_tags.length; i++) {
                        const jump_time = comments_a_tags[i].getAttribute('data-jump-time')

                        if(jump_time) {
                            comments_a_tags[i].addEventListener('click', function(e) {
                                e.preventDefault()
                                player.currentTime = jump_time;
                            })
                        }
                    }
                } else { 
                    document.getElementById('comments').innerHTML = "コメントの読み込みに失敗しました。再読み込み等をお試し下さい。"; 
                }
            };
            xhr.send();

            let player = document.getElementById("player");

            document.cookie = "yuki=True; path=/; max-age=10800;";
        

            const haveLoopCookie = getCookie("loop") === 'true' ? true : false;
            player.loop = haveLoopCookie;
            document.getElementById("loop").checked = haveLoopCookie;

            document.getElementById("autonextpage").checked = getCookie("autonextpage") === 'true' ? true : false;
            

            function changeAutoNextPage(checkbox) {      
                document.cookie =  `autonextpage=${checkbox.checked}; path=/; max-age=10800;`;
            }
            
            function autoNextPage() {
                const enable_autoNextPage = document.getElementById('autonextpage').checked;
                document.cookie = `autonextpage=${enable_autoNextPage}; max-age=10800;`;
                if (enable_autoNextPage) {
                    setTimeout(() => {
                        location.replace("/watch?v={{ recommended_videos[0]['video_id'] }}");
                    }, 5000)
                }
            }

            player.addEventListener('ended', autoNextPage)
            
            function changeLoop(checkbox) {      
                const enable_loop = checkbox.checked;
                document.getElementById("player").loop = enable_loop;
                document.cookie = `loop=${enable_loop}; path=/; max-age=10800;`;
            }
            
            /* function sleep(waitMsec) {      var startMsec = new Date();while (new Date() - startMsec < waitMsec);} */

            

            document.getElementById("player").currentTime = getQueryValue('t') || 0;
            
            function keydown(key) {                  
                if (key.keyCode == 32 || key.keyCode == 75) {
                    const v = document.getElementById("player");

                    if (v.paused === true) {
                        v.play();
                    } else {
                        v.pause();
                    }
                }
            }
        
            window.addEventListener('keydown', keydown);
        

            const description_a_tags = document.getElementById('descriptionWrapper').getElementsByTagName('a');
            for(let i = 0; i < description_a_tags.length; i++) {
                const jump_time = description_a_tags[i].getAttribute('data-jump-time')

                if(jump_time) {
                    description_a_tags[i].addEventListener('click', function(e) {
                        e.preventDefault()
                        player.currentTime = jump_time;
                    })
                }
            }

            player.style.maxHeight = document.documentElement.clientHeight * 0.8 + "px";

            let info = document.getElementById('video_info');

            let reload_button_elm = document.createElement('button');
            reload_button_elm.setAttribute('onclick', 'location.replace(location.href);');
            reload_button_elm.innerHTML = 'リロード';
            
            
            setTimeout(() => {
                if(player.networkState === 3){
                    let update_api_xhr = new XMLHttpRequest();
                    update_api_xhr.open("GET", "/api/video/next"); 
                    update_api_xhr.send();
                    
                    info.innerHTML = '動画の読み込みに失敗しました。再読み込み等をお試し下さい。<br>';
                    info.innerHTML += '過度な再読み込みはインスタンスに負荷がかかり、短期間で使用不能に陥ることや、動画等の読み込みが出来なくなることが考えられますのでご遠慮下さい。'
                    player.after(reload_button_elm)
                    player.after(info)
                    player.remove()
                }
            }, 1000);
            
            (function updateDisplayCurrentTime() {
                setTimeout(() => {
                    const player = document.getElementById('player');
                    const current_time_elem = document.getElementById('player_current_time')
                    if(player) {
                        current_time_elem.textContent = secToHMS(player.currentTime | 0);
                    } else {
                        current_time_elem.textContent = 'Error';
                    }
                    updateDisplayCurrentTime();
                }, 100);
            })();
        </script>
        <script>
            $('#searchbox').autocomplete({
                source: function (request, response) {      
                    {
                        const url = "/suggest?keyword=" + request.term;
                        const xhr = new XMLHttpRequest();
                        xhr.open("GET", url);
                        xhr.onload = function () {      
                            response(JSON.parse(xhr.responseText));
                        }
                        xhr.send();
                    }
                }, delay: 300
            });
        </script>
		<div class="latest-info" id="latestInfo">
  <h3>welcome!!</h3>
  <div id="infoContent">chatにきてください‼︎「その他」のところにあります‼︎</div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const infoContent = document.getElementById("infoContent");
    let toggle = true;
    
    // 5秒ごとに「内容1」と「内容2」を交互に表示
    setInterval(() => {
      infoContent.textContent = toggle ? "高画質機能追加！左にある高画質再生を押してみて‼︎" : "chatにきてください‼︎「その他」のところにあります‼︎";
      toggle = !toggle;
    }, 5000);
  });
</script>    
		    <!-- 動画視聴ページの適当な場所に追加 -->
<script>
function addToHistory() {
  // サーバーサイドのテンプレートで動的に値を埋め込む
  const videoData = {
    video_id: "{{ videoid }}",  // 動画ID
    // プロキシ有無に応じたサムネイルURL（テンプレートエンジンの構文例）
    thumbnail: "{% if proxy == 'True' %}/thumbnail?v={{ videoid }}{% else %}https://img.youtube.com/vi/{{ videoid }}/0.jpg{% endif %}",
    length: "{{ length_text }}",           // 動画の長さ（例："0:05:24"）
    title: "{{ video_title }}",            // 動画タイトル
    channel: "{{ author }}",               // チャンネル名
    channel_id: "{{ author_id }}",         // チャンネルID
    view_count: "{{ view_count }}",        // 再生回数（例："6M views"）
    published: "{{ published_date }}"      // 公開期間（例："3 years ago"）
  };

  // localStorage から既存の履歴を取得（なければ空の配列）
  let history = localStorage.getItem('watchHistory');
  history = history ? JSON.parse(history) : [];

  // 同じ動画がすでにあれば削除（最新の履歴を先頭に追加するため）
  history = history.filter(item => item.video_id !== videoData.video_id);
  
  // 配列の先頭に追加（最新履歴を上に表示）
  history.unshift(videoData);

  // 保存件数に上限を設定（例：最新50件まで保存）
  if (history.length > 50) {
    history = history.slice(0, 50);
  }

  // JSON形式で localStorage に保存
  localStorage.setItem('watchHistory', JSON.stringify(history));
}

// ページ読み込み時に履歴に登録
window.addEventListener('load', addToHistory);
</script>

</body>
</html>
